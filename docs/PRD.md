# 简化版舆情分析工具 · 产品需求文档（PRD）

## 1. 更新记录

| 版本 | 日期       | 主要更新                                                                                                                                                           | 负责人 |
| ---- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------ |
| v0.2 | 2024-07-30 | **后端**: 优化 `crawler` 模式性能，通过 `asyncio.gather` 实现并行抓取并增加超时控制；修复了 `weasyprint` 启动时因缺少 `gobject-2.0` 库导致的 `OSError`。<br>**前端**: 优化了 UI 交互，将提示信息移至实时日志，并为报告和日志区域添加了固定高度和内部滚动功能。 | AI 助理 |
| v0.1 | 2024-07-29 | **后端**: 完成基础架构，实现了 `mock` 和 `crawler` 两种模式，支持调用豆包 LLM 生成报告和导出 PDF。<br>**前端**: 搭建了基本页面布局，包括报告展示和实时日志。 | AI 助理 |

## 2. 产品概述
做一个面向个人/小团队的“简化版舆情分析工具”。用户输入主题后，系统在公开网页中搜索相关内容，调用 LLM 生成结构化分析报告（Markdown），并支持导出为 PDF。界面参考提供的原型图：左侧展示报告，右侧显示实时日志。

## 3. 目标与价值
- 低门槛地获得某一主题的舆情/资讯概览与建议。
- 快速看到效果（一次点击生成），便于后续迭代扩展到更多数据源和更复杂分析。

## 4. 使用场景与角色
- 个人研究者/运营人员：临时分析一个话题或事件。
- 小团队：内部会议前快速生成分析材料。

## 5. 核心功能（MVP）
1) 主题输入与一键生成：用户输入主题，点击“开始”，触发整个流程。
2) 网页搜索：默认使用 DuckDuckGo（免 Key），抓取标题、摘要、链接；可在配置中切换为 Bing/SerpAPI。
3) **并行正文抓取**：对 Top-N 链接进行**并行抓取**，设有超时控制，提升了抓取效率和稳定性。
4) LLM 分析与报告生成：调用豆包 LLM（支持流式输出），生成包含以下结构的 Markdown 报告：
   - 概览与热度判断
   - 关键叙事与观点阵营
   - 情感与风险点
   - 证据链（关键来源的标题+链接，必要时附引用片段）
   - 建议（舆情应对/进一步采样/信息核验）
5) 报告展示与导出：
   - 左侧以 Markdown 渲染显示；
   - 可导出为 PDF（使用 **WeasyPrint**）。
6) 右侧实时日志：
   - 实时展示进度、关键步骤与错误信息。
   - **提示信息（如内容不足建议）也会作为日志条目显示**。

## 6. 非目标（MVP 不做）
- 不做账号/私有库数据接入与权限体系；
- 不做国内社媒的复杂反爬与多模态视频解析；
- 不做多智能体辩论协作（Forum/Insight/Media 等暂不实现）。

## 7. 关键约束
- 合规：仅抓取公开网页内容，尊重网站的 robots 与使用条款；
- 成本与速度：受 LLM 模型与抓取数量影响，默认 Top-N 可配置（建议 10–20）；
- 稳定性：搜索结果时间范围不可严格保证（DuckDuckGo 的限制），后续可切换到有时间筛选的提供者。

## 8. 成功标准（验收）
- 输入一个主题，点击“开始”后 **15–60 秒**内生成可读的 Markdown 报告（性能提升）；
- 本地保存报告文件：`reports/report_<ID>.md` 与对应 PDF；
- 右侧日志持续滚动，能看到清晰的执行节点；
- 出错时日志清晰显示原因（网络、限流、模型报错等）。

## 9. 交互与UI
- 顶部：输入框 + “开始生成”按钮；
- 左侧：报告区，**固定高度，内部可滚动**；
- 右侧：实时日志区，**固定高度，内部可滚动**；
- 简单、清晰，响应式布局。

## 10. 配置项（通过 .env 或设置页）
- `SEARCH_PROVIDER`：ddg（默认）/bing/serpapi；
- `MAX_RESULTS`：默认 12；
- `FETCH_HTML`：是否抓正文，默认 true；
- `DOUBAO_API_KEY`：豆包 API Key（必需）；
- `DOUBAO_MODEL`：模型 ID（必需）；
- `DOUBAO_BASE_URL`：豆包 API 地址；
- `STREAM_OUTPUT`：是否启用流式输出，默认 true；

## 11. 报告模板（初版）
- 一级标题：主题 + 时间区间（可选）
- 1. 概览
- 2. 关键叙事与观点阵营
- 3. 情感与风险
- 4. 证据链（标题+链接+可选引用片段）
- 5. 建议与后续行动

## 12. 风险与缓解
- 搜索源不稳定：增加失败重试与备用搜索源；
- 抓取阻断：**已通过并行抓取+超时控制缓解**；
- LLM 成本：控制输入长度与条目数量，使用低温度与性价比模型；
- **PDF 依赖**：`WeasyPrint` 依赖 `pango` 等系统库，需通过 `brew install pango` 安装。

## 13. 版本规划
- v0.1（MVP）：完成基础功能。
- v0.2：**性能与体验优化**。
- v0.3：可切换搜索源、时间范围过滤、报告模板选择；
- v0.4：证据片段引用、基础指标图表（来源分布、时间线）。